#:import utils kivy.utils
#:import Clock kivy.clock.Clock
<CalcScreen>:
    rwy1: rwy1.__self__
    rwy2: rwy2.__self__
    rwy3: rwy3.__self__
    rwy4: rwy4.__self__
    rwy5: rwy5.__self__
    rwy6: rwy6.__self__
    ldr_txt: ldr_txt.__self__
    FloatLayout:
        canvas:
            Color:
                rgb: utils.get_color_from_hex("#000000")
            Rectangle:
                size: self.size
                pos: self.pos
    Label:
        id: airport_tile
        markup: True
        text: "The airport name"
        font_size: '20sp'
        pos_hint: {"top": 1, "center_x": .5}
        size_hint: 1, .1

##################################### RUNWAYS  ##################################################

    GridLayout:
        rows: 1
        id: rwy5
        pos_hint: {"top": .92, "center_x": .125}
        size_hint: .14, .07
        spacing: 5, 5
        RoundedButton:
            text: ""
            id:rw5
            markup: True
            font_size: '20sp'
            padding: 20, 20
            on_press:
                app.root.ids['calc_screen'].ids['_rwy'].text= "[b][color=#3E9933]RUNWAY " + self.text + '[/color][/b]'
                app.root.ids['calc_screen'].ids['runway_'].text = self.text
                app.lda_txt(app.root.ids['home_screen'].ids['dest1'].text, self.text)
                app.enable_button()
                self.opacity = .5
                app.root.ids['calc_screen'].ids['rw1'].opacity = 1
                app.root.ids['calc_screen'].ids['rw2'].opacity = 1
                app.root.ids['calc_screen'].ids['rw3'].opacity = 1
                app.root.ids['calc_screen'].ids['rw4'].opacity = 1
                app.root.ids['calc_screen'].ids['rw6'].opacity = 1
    GridLayout:
        rows: 1
        id: rwy3
        pos_hint: {"top": .92, "center_x": .275}
        size_hint: .14, .07
        spacing: 5, 5
        RoundedButton:
            text: ""
            id:rw3
            markup: True
            font_size: '20sp'
            padding: 20, 20
            on_press:
                app.root.ids['calc_screen'].ids['_rwy'].text= "[b][color=#3E9933]RUNWAY " + self.text + '[/color][/b]'
                app.root.ids['calc_screen'].ids['runway_'].text = self.text
                app.lda_txt(app.root.ids['home_screen'].ids['dest1'].text, self.text)
                app.enable_button()
                self.opacity = .5
                app.root.ids['calc_screen'].ids['rw1'].opacity = 1
                app.root.ids['calc_screen'].ids['rw2'].opacity = 1
                app.root.ids['calc_screen'].ids['rw4'].opacity = 1
                app.root.ids['calc_screen'].ids['rw5'].opacity = 1
                app.root.ids['calc_screen'].ids['rw6'].opacity = 1
    GridLayout:
        rows: 1
        id: rwy1
        pos_hint: {"top": .92, "center_x": .425}
        size_hint: .14, .07
        spacing: 5, 5
        RoundedButton:
            text: ""
            id:rw1
            markup: True
            font_size: '20sp'
            padding: 20, 20
            on_press:
                app.root.ids['calc_screen'].ids['_rwy'].text= "[b][color=#3E9933]RUNWAY " + self.text + '[/color][/b]'
                app.root.ids['calc_screen'].ids['runway_'].text = self.text
                app.lda_txt(app.root.ids['home_screen'].ids['dest1'].text, self.text)
                app.enable_button()
                self.opacity = .5
                app.root.ids['calc_screen'].ids['rw2'].opacity = 1
                app.root.ids['calc_screen'].ids['rw3'].opacity = 1
                app.root.ids['calc_screen'].ids['rw4'].opacity = 1
                app.root.ids['calc_screen'].ids['rw5'].opacity = 1
                app.root.ids['calc_screen'].ids['rw6'].opacity = 1
    GridLayout:
        rows: 1
        id: rwy2
        pos_hint: {"top": .92, "center_x": .575}
        size_hint: .14, .07
        spacing: 5, 5
        RoundedButton:
            text: ""
            id:rw2
            markup: True
            font_size: '20sp'
            padding: 20, 20
            on_press:
                app.root.ids['calc_screen'].ids['_rwy'].text= "[b][color=#3E9933]RUNWAY " + self.text + '[/color][/b]'
                app.root.ids['calc_screen'].ids['runway_'].text = self.text
                app.lda_txt(app.root.ids['home_screen'].ids['dest1'].text, self.text)
                app.enable_button()
                self.opacity = .5
                app.root.ids['calc_screen'].ids['rw1'].opacity = 1
                app.root.ids['calc_screen'].ids['rw3'].opacity = 1
                app.root.ids['calc_screen'].ids['rw4'].opacity = 1
                app.root.ids['calc_screen'].ids['rw5'].opacity = 1
                app.root.ids['calc_screen'].ids['rw6'].opacity = 1
    GridLayout:
        rows: 1
        id: rwy4
        pos_hint: {"top": .92, "center_x": .725}
        size_hint: .14, .07
        spacing: 5, 5
        RoundedButton:
            text: ""
            id:rw4
            markup: True
            font_size: '20sp'
            padding: 20, 20
            on_press:
                app.root.ids['calc_screen'].ids['_rwy'].text= "[b][color=#3E9933]RUNWAY " + self.text + '[/color][/b]'
                app.root.ids['calc_screen'].ids['runway_'].text = self.text
                app.lda_txt(app.root.ids['home_screen'].ids['dest1'].text, self.text)
                app.enable_button()
                self.opacity = .5
                app.root.ids['calc_screen'].ids['rw1'].opacity = 1
                app.root.ids['calc_screen'].ids['rw2'].opacity = 1
                app.root.ids['calc_screen'].ids['rw3'].opacity = 1
                app.root.ids['calc_screen'].ids['rw5'].opacity = 1
                app.root.ids['calc_screen'].ids['rw6'].opacity = 1
    GridLayout:
        rows: 1
        id: rwy6
        pos_hint: {"top": .92, "center_x": .875}
        size_hint: .14, .07
        spacing: 5, 5
        RoundedButton:
            text: ""
            id:rw6
            markup: True
            font_size: '20sp'
            padding: 20, 20
            on_press:
                app.root.ids['calc_screen'].ids['_rwy'].text= "[b][color=#3E9933]RUNWAY " + self.text + '[/color][/b]'
                app.root.ids['calc_screen'].ids['runway_'].text = self.text
                app.lda_txt(app.root.ids['home_screen'].ids['dest1'].text, self.text)
                app.enable_button()
                self.opacity = .5
                app.root.ids['calc_screen'].ids['rw1'].opacity = 1
                app.root.ids['calc_screen'].ids['rw2'].opacity = 1
                app.root.ids['calc_screen'].ids['rw3'].opacity = 1
                app.root.ids['calc_screen'].ids['rw4'].opacity = 1
                app.root.ids['calc_screen'].ids['rw5'].opacity = 1


########################### INPUT DATA ON LEFT SIDE   ##################################################

    GridLayout:
        rows: 1
        pos_hint: {"top": .83, "center_x": .256}
        size_hint: .4, .07
        spacing: 5, 5
        RoundedText:
            id: ldg_wt
            markup: True
            multiline: False
            font_size: '20sp'
            hint_text: "ldg weight kg"
            opacity: 1 if self.text else .7
            padding_y: [self.height / 2.0 - (self.line_height / 2.0) * len(self._lines), 0]
            padding_x: [10, 0]
            text: self.text.upper() if self.text is not None else ''
            size_hint: .3, .07
            pos_hint: {"top": .8, "center_x": .5}
            on_focus:
                Clock.schedule_once(lambda dt: self.select_all()) if self.focus else None
                app.ldg_wt_txt()
                app.root.ids['calc_screen'].ids['ldg_wt_'].text = self.text
                app.enable_button()

    GridLayout:
        rows: 1
        pos_hint: {"top": .74, "center_x": .256}
        size_hint: .4, .07
        spacing: 5, 5
        RoundedButton:
            text: "FLAP 10"
            id: f10
            markup: True
            font_size: '18sp'
            padding: 20, 20
            on_press:
                app.root.ids['calc_screen'].ids['flap'].text= '[b][color=#3E9933]' + self.text +'[/color][/b]'
                app.root.ids['calc_screen'].ids['flap_'].text = self.text
                app.enable_button()
                self.opacity = .5
                app.root.ids['calc_screen'].ids['f15'].opacity = 1
                app.root.ids['calc_screen'].ids['f35'].opacity = 1
        RoundedButton:
            text: "FLAP 15"
            id: f15
            markup: True
            font_size: '18sp'
            padding: 20, 20
            on_press:
                app.root.ids['calc_screen'].ids['flap'].text= '[b][color=#3E9933]' + self.text + '[/color][/b]'
                app.root.ids['calc_screen'].ids['flap_'].text = self.text
                app.enable_button()
                self.opacity = .5
                app.root.ids['calc_screen'].ids['f10'].opacity = 1
                app.root.ids['calc_screen'].ids['f35'].opacity = 1
        RoundedButton:
            text: "FLAP 35"
            id: f35
            markup: True
            font_size: '18sp'
            padding: 20, 20
            on_press:
                app.root.ids['calc_screen'].ids['flap'].text= '[b][color=#3E9933]' + self.text + '[/color][/b]'
                app.root.ids['calc_screen'].ids['flap_'].text = self.text
                app.enable_button()
                self.opacity = .5
                app.root.ids['calc_screen'].ids['f10'].opacity = 1
                app.root.ids['calc_screen'].ids['f15'].opacity = 1

    GridLayout:
        rows: 1
        pos_hint: {"top": .65, "center_x": .256}
        size_hint: .4, .07
        spacing: 5, 5
        RoundedText:
            id: wind
            markup: True
            multiline: False
            font_size: '20sp'
            hint_text: "ldg wind"
            opacity: 1 if self.text else .7
            padding_y: [self.height / 2.0 - (self.line_height / 2.0) * len(self._lines), 0]
            padding_x: [10, 0]
            text: self.text.upper() if self.text is not None else ''
            on_focus:
                Clock.schedule_once(lambda dt: self.select_all()) if self.focus else None
                app.wind_component(self.text)

        RoundedButton:
            text: "HEAD"
            id: head_btn
            markup: True
            font_size: '18sp'
            padding: 20, 20
            disabled: True if wind.text == '' else False
            on_press:
                app.head_tail("KT HEADWIND")
                app.root.ids['calc_screen'].ids['_wind'].text= '[b][color=#3E9933]' + wind.text + "KT HEADWIND[/color][/b]"
                app.root.ids['calc_screen'].ids['wind_'].text= wind.text + "KT HEADWIND"
                app.enable_button()
                self.opacity = .5
                app.root.ids['calc_screen'].ids['tail_btn'].opacity = 1

        RoundedButton:
            text: "TAIL"
            id: tail_btn
            markup: True
            font_size: '18sp'
            padding: 20, 20
            disabled: True if wind.text == '' else False
            on_press:
                app.head_tail("KT TAILWIND")
                app.root.ids['calc_screen'].ids['_wind'].text= '[b][color=#3E9933]' + wind.text + "KT TAILWIND[/color][/b]"
                app.root.ids['calc_screen'].ids['wind_'].text= wind.text + "KT TAILWIND"
                app.enable_button()
                self.opacity = .5
                app.root.ids['calc_screen'].ids['head_btn'].opacity = 1
    ClearBox:
        pos_hint: {"top": .66, "center_x": .27}
        size_hint: .445, .18
    Label:
        id: optional_txt
        rows: 1
        markup: True
        font_size: '13sp'
        pos_hint: {"top": .575, "center_x": .47}
        halign: 'center'
        size_hint: .2, .01
        markup: True
        text: "[color=#FBBF34]O\nP\nT\nI\nO\nN\nA\nL[/color]"

    GridLayout:
        rows: 1
        pos_hint: {"top": .56, "center_x": .256}
        size_hint: .4, .07
        spacing: 5, 5
        RoundedText:
            id: temp
            markup: True
            multiline: False
            font_size: '20sp'
            hint_text: "ldg temp"
            opacity: 1 if self.text else .7
            padding_y: [self.height / 2.0 - (self.line_height / 2.0) * len(self._lines), 0]
            padding_x: [10, 0]
            text: self.text.upper() if self.text is not None else ''
            on_focus:
                Clock.schedule_once(lambda dt: self.select_all()) if self.focus else None
                app.root.ids['calc_screen'].ids['temp_'].text = self.text
        RoundedButton:
            text: "BLEED ON"
            id:bl_on
            markup: True
            font_size: '18sp'
            padding: 20, 20
            disabled: True if temp.text == '' else False
            on_press:
                app.root.ids['calc_screen'].ids['bleed_'].text = self.text
                self.opacity = .5
                app.root.ids['calc_screen'].ids['bl_off'].opacity = 1
        RoundedButton:
            text: "BLEED OFF"
            id:bl_off
            markup: True
            font_size: '18sp'
            padding: 20, 20
            disabled: True if temp.text == '' else False
            on_press:
                app.root.ids['calc_screen'].ids['bleed_'].text = self.text
                self.opacity = .5
                app.root.ids['calc_screen'].ids['bl_on'].opacity = 1
    GridLayout:
        rows: 1
        pos_hint: {"top": .47, "center_x": .256}
        size_hint: .4, .07
        spacing: 5, 5
        RoundedText:
            id: vapp_add
            markup: True
            multiline: False
            font_size: '20sp'
            hint_text: "knots above Vref"
            opacity: 1 if self.text else .7
            padding_y: [self.height / 2.0 - (self.line_height / 2.0) * len(self._lines), 0]
            padding_x: [10, 0]
            text: self.text.upper() if self.text is not None else ''
            size_hint: .3, .07
            pos_hint: {"top": .4, "center_x": .5}
            on_focus:
                Clock.schedule_once(lambda dt: self.select_all()) if self.focus else None
                app.vapp_vref_txt()
                app.root.ids['calc_screen'].ids['vapp_add_'].text= vapp_add.text
                app.enable_button()
    GridLayout:
        rows: 1
        pos_hint: {"top": .38, "center_x": .256}
        size_hint: .4, .07
        spacing: 5, 5
        RoundedButton:
            text: "REDUCED NP"
            id: red_np
            markup: True
            font_size: '18sp'
            padding: 20, 20
            on_press:
                app.root.ids['calc_screen'].ids['reduced_np'].text= "[b][color=#3E9933]REDUCED NP[/color][/b]"
                app.root.ids['calc_screen'].ids['reduced_np_'].text= "REDUCED NP"
                app.enable_button()
                self.opacity = .5
                app.root.ids['calc_screen'].ids['1020_r'].opacity = 1
        RoundedButton:
            text: "1020 RPM"
            id: 1020_r
            markup: True
            font_size: '18sp'
            padding: 20, 20
            on_press:
                app.root.ids['calc_screen'].ids['reduced_np'].text= "[b][color=#3E9933]1020 RPM[/color][/b]"
                app.root.ids['calc_screen'].ids['reduced_np_'].text= "1020 RPM"
                app.enable_button()
                self.opacity = .5
                app.root.ids['calc_screen'].ids['red_np'].opacity = 1
    GridLayout:
        rows: 1
        pos_hint: {"top": .29, "center_x": .256}
        size_hint: .4, .07
        spacing: 5, 5
        RoundedButton:
            text: "REF SPEEDS INCR"
            id: ref_inc
            markup: True
            font_size: '18sp'
            padding: 20, 20
            on_press:
                app.root.ids['calc_screen'].ids['ref_speeds'].text= "[b][color=#3E9933]REF SPEEDS INCR[/color][/b]"
                app.root.ids['calc_screen'].ids['ref_speeds_'].text= "REF SPEEDS INCR"
                app.enable_button()
                self.opacity = .5
                app.root.ids['calc_screen'].ids['ref_off'].opacity = 1
        RoundedButton:
            text: "REF SPEEDS OFF"
            id: ref_off
            markup: True
            font_size: '18sp'
            padding: 20, 20
            on_press:
                app.root.ids['calc_screen'].ids['ref_speeds'].text= "[b][color=#3E9933]REF SPEEDS OFF[/color][/b]"
                app.root.ids['calc_screen'].ids['ref_speeds_'].text= "REF SPEEDS OFF"
                app.enable_button()
                self.opacity = .5
                app.root.ids['calc_screen'].ids['ref_inc'].opacity = 1
    GridLayout:
        rows: 1
        pos_hint: {"top": .2, "center_x": .256}
        size_hint: .4, .07
        spacing: 5, 5
        RoundedButton:
            text: "WET RWY"
            id: wet
            markup: True
            font_size: '18sp'
            padding: 20, 20
            on_press:
                app.root.ids['calc_screen'].ids['wet_dry'].text= "[b][color=#3E9933]WET RUNWAY[/color][/b]"
                app.root.ids['calc_screen'].ids['wet_dry_'].text= "WET"
                app.enable_button()
                self.opacity = .5
                app.root.ids['calc_screen'].ids['dry'].opacity = 1
        RoundedButton:
            text: "DRY RWY"
            id: dry
            markup: True
            font_size: '18sp'
            padding: 20, 20
            on_press:
                app.root.ids['calc_screen'].ids['wet_dry'].text= "[b][color=#3E9933]DRY RUNWAY[/color][/b]"
                app.root.ids['calc_screen'].ids['wet_dry_'].text= "DRY"
                app.enable_button()
                self.opacity = .5
                app.root.ids['calc_screen'].ids['wet'].opacity = 1


##############################  TEXT COLUMN ON RIGHT SIDE   #############################
    Label:
        id: title_text
        rows: 1
        markup: True
        font_size: '20sp'
        pos_hint: {"top": .84, "center_x": .7}
        size_hint: .45, .05
        markup: True
        text: "[b][u]REQUIRED INPUTS IN RED[/u][/b]"
    Label:
        id: _rwy
        rows: 1
        markup: True
        font_size: '20sp'
        pos_hint: {"top": .79, "center_x": .7}
        size_hint: .45, .05
        markup: True
        text: "[color=#FF3D16]RUNWAY[/color]"
    Label:
        id: _ldg_wt
        rows: 1
        markup: True
        font_size: '20sp'
        pos_hint: {"top": .74, "center_x": .7}
        size_hint: .45, .05
        markup: True
        text: "[color=#FF3D16]WEIGHT[/color]"
    Label:
        id: flap
        rows: 1
        markup: True
        font_size: '20sp'
        pos_hint: {"top": .69, "center_x": .7}
        size_hint: .45, .05
        markup: True
        text: "[color=#FF3D16]FLAP[/color]"
    Label:
        id: _wind
        rows: 1
        markup: True
        font_size: '20sp'
        pos_hint: {"top": .64, "center_x": .7}
        size_hint: .45, .05
        markup: True
        text: "[color=#8A8A8A]WIND[/color]"
    Label:
        id: _vapp_add
        rows: 1
        markup: True
        font_size: '20sp'
        pos_hint: {"top": .59, "center_x": .7}
        size_hint: .45, .05
        markup: True
        text: "[color=#FF3D16]VAPP[/color]"
    Label:
        id: reduced_np
        rows: 1
        markup: True
        font_size: '20sp'
        pos_hint: {"top": .54, "center_x": .7}
        size_hint: .45, .05
        markup: True
        text: "[color=#FF3D16]REDUCED/1020RPM[/color]"
    Label:
        id: ref_speeds
        rows: 1
        markup: True
        font_size: '20sp'
        pos_hint: {"top": .49, "center_x": .7}
        size_hint: .45, .05
        markup: True
        text: "[color=#FF3D16]REF SPEEDS[/color]"
    Label:
        id: wet_dry
        rows: 1
        markup: True
        font_size: '20sp'
        pos_hint: {"top": .44, "center_x": .7}
        size_hint: .45, .05
        markup: True
        text: "[color=#FF3D16]WET OR DRY[/color]"
    ClearGreenBox:
        pos_hint: {"top": .29, "center_x": .7}
        size_hint: .47, .13
    Label:
        id: lda_txt
        rows: 1
        markup: True
        font_size: '22sp'
        pos_hint: {"top": .29, "center_x": .7}
        size_hint: .45, .05
        markup: True
    Label:
        id: ldr_txt
        rows: 1
        markup: True
        font_size: '22sp'
        pos_hint: {"top": .22, "center_x": .7}
        size_hint: .45, .05
        markup: True
    ClearGreenBox:
        pos_hint: {"top": .15, "center_x": .7}
        size_hint: .47, .13
    GridLayout:
        rows: 1
        pos_hint: {"top": .14, "center_x": .7}
        size_hint: .45, .05
        spacing: 5, 5
        Label:
            id: wat_limit_info
            rows:1
            markup: True
            font_size: '18sp'
            markup: True
            opacity: 0.5
            text: "For WAT calculation, please also enter"
    GridLayout:
        rows: 1
        pos_hint: {"top": .08, "center_x": .7}
        size_hint: .45, .05
        spacing: 5, 5
        Label:
            id: wat_limit_result
            rows:1
            markup: True
            font_size: '19sp'
            markup: True
            opacity: 0.5
            text: "airport temp and bleed switch position"
########################################  DATA STORAGE LABELS   ##################################
    Label:
        id: runway_
        opacity: 0
    Label:
        id: ldg_wt_
        opacity: 0
    Label:
        id: flap_
        opacity: 0
    Label:
        id: wind_
        text: ''
        opacity: 0
    Label:
        id: vapp_add_
        opacity: 0
    Label:
        id: reduced_np_
        opacity: 0
    Label:
        id: ref_speeds_
        opacity: 0
    Label:
        id: wet_dry_
        opacity: 0
    Label:
        id: temp_
        opacity: 0
    Label:
        id: bleed_
        opacity:0

######################################  BUTTONS   ###################################
    RoundedButton:
        text: "Calculate"
        id: go_button
        markup: True
        font_size: '20sp'
        pos_hint:  {"top": .39, "center_x": .7}
        size_hint: .3, .08
        padding: 20, 20
        opacity: 1 if self.state == 'normal' else .5
        disabled: True
        on_release:
            app.store_units()
    RoundedBackButton:
        text: "Back"
        id: back_button
        markup: True
        font_size: '20sp'
        pos_hint:  {"top": .1, "center_x": .156}
        size_hint: .2, .08
        padding: 20, 20
        opacity: 1 if self.state == 'normal' else .5
        on_release:
            app.change_screen("home_screen")
            app.remove_rwy_buttons()
            app.restore_original_text()

<RoundedBackButton@Button>
    background_color: (0,0,0,0)
    background_normal: ''
    back_color: (1,0,1,1)
    border_radius: [15]
    canvas.before:
        Color:
            rgb: utils.get_color_from_hex("#1C6426")
        RoundedRectangle:
            size: self.size
            pos: self.pos
            radius: [15]
<ClearBox@Label>
    background_color: (0,0,0,0)
    background_normal: ''
    back_color: utils.get_color_from_hex("#FBBF34")
    border_radius: 18
    color: self.back_color
    canvas.before:
        Color:
            rgb: utils.get_color_from_hex("#FBBF34")
        Line:
            rounded_rectangle: (self.pos[0], self.pos[1], self.size[0], self.size[1], self.border_radius)
            width: 1.5
<ClearGreenBox@Label>
    background_color: (0,0,0,0)
    background_normal: ''
    back_color: utils.get_color_from_hex("#2C910C")
    border_radius: 18
    color: self.back_color
    canvas.before:
        Color:
            rgb: utils.get_color_from_hex("#2C910C")
        Line:
            rounded_rectangle: (self.pos[0], self.pos[1], self.size[0], self.size[1], self.border_radius)
            width: 1.5